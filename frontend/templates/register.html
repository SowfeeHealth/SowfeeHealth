<!DOCTYPE html>
<html lang="en">
  <link rel="icon" type="image/x-icon" href="/images/sowfeefavicon.png" />

  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Sowfee Health - Login</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
    />
    <style>
      :root {
        --primary: #6936f5;
        --secondary: #f8f9fe;
        --accent: #ff6b6b;
        --text: #2d2d35;
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: "Inter", system-ui, -apple-system, sans-serif;
      }

      body {
        background: linear-gradient(135deg, #f8f0ff 0%, #e6e1ff 100%);
        min-height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .login-container {
        background: white;
        padding: 3rem;
        border-radius: 20px;
        box-shadow: 0 10px 40px rgba(105, 54, 245, 0.1);
        width: 100%;
        max-width: 440px;
        margin: 1rem;
      }

      .logo {
        text-align: center;
        margin-bottom: 2.5rem;
        font-size: 2rem;
        font-weight: 700;
        background: linear-gradient(45deg, var(--primary), #8a63f2);
        -webkit-background-clip: text;
        background-clip: text;
        color: transparent;
      }

      .form-group {
        margin-bottom: 1.5rem;
      }

      label {
        display: block;
        margin-bottom: 0.5rem;
        color: var(--text);
        font-weight: 500;
      }

      input {
        width: 100%;
        padding: 1rem;
        border: 2px solid #e8e9f1;
        border-radius: 10px;
        font-size: 1rem;
        transition: all 0.3s ease;
      }

      input:focus {
        outline: none;
        border-color: var(--primary);
        box-shadow: 0 0 0 3px rgba(105, 54, 245, 0.1);
      }

      .login-btn {
        width: fit-content;
        padding: 1rem;
        background: var(--primary);
        color: white;
        border: none;
        border-radius: 10px;
        font-size: 1rem;
        font-weight: 600;
        cursor: pointer;
        transition: transform 0.3s ease;
        margin-left: 10px;
      }

      .login-btn:hover {
        transform: translateY(-2px);
      }

      .links {
        margin-top: 1.5rem;
        text-align: center;
      }

      .links a {
        color: var(--primary);
        text-decoration: none;
        font-size: 0.9rem;
      }

      .divider {
        margin: 2rem 0;
        position: relative;
        text-align: center;
        color: #888;
      }

      .divider::before {
        content: "";
        position: absolute;
        top: 50%;
        left: 0;
        right: 0;
        border-top: 1px solid #eee;
        z-index: 1;
      }

      .divider span {
        background: white;
        position: relative;
        z-index: 2;
        padding: 0 1rem;
      }

      .social-login {
        display: flex;
        gap: 1rem;
        margin-top: 1.5rem;
      }

      .social-btn {
        flex: 1;
        padding: 0.8rem;
        border: 1px solid #e8e9f1;
        border-radius: 8px;
        background: white;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .social-btn:hover {
        border-color: var(--primary);
        transform: translateY(-2px);
      }

      @media (max-width: 480px) {
        .login-container {
          padding: 2rem;
          margin: 1rem;
        }

        .logo {
          font-size: 1.75rem;
        }
      }
      .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        z-index: 1000;
      }

      .modal-content {
        position: relative;
        background-color: white;
        margin: 15% auto;
        padding: 20px;
        border-radius: 10px;
        width: 80%;
        max-width: 400px;
        text-align: center;
      }

      .close-button {
        position: absolute;
        right: 10px;
        top: 10px;
        cursor: pointer;
        font-size: 20px;
      }

      .form-select {
        width: 100%;
        padding: 1rem;
        border: 2px solid #e8e9f1;
        border-radius: 10px;
        font-size: 1rem;
        appearance: none;
      }

      /* .select-container {
        background-image: url("./../../images/down-arrow-svgrepo-com.svg") no-repeat right #000;
      } */

      select{
        background: url(data:image/svg+xml;base64,PHN2ZyBpZD0iTGF5ZXJfMSIgZGF0YS1uYW1lPSJMYXllciAxIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA0Ljk1IDEwIj48ZGVmcz48c3R5bGU+LmNscy0xe2ZpbGw6I2ZmZjt9LmNscy0ye2ZpbGw6IzQ0NDt9PC9zdHlsZT48L2RlZnM+PHRpdGxlPmFycm93czwvdGl0bGU+PHJlY3QgY2xhc3M9ImNscy0xIiB3aWR0aD0iNC45NSIgaGVpZ2h0PSIxMCIvPjxwb2x5Z29uIGNsYXNzPSJjbHMtMiIgcG9pbnRzPSIxLjQxIDQuNjcgMi40OCAzLjE4IDMuNTQgNC42NyAxLjQxIDQuNjciLz48cG9seWdvbiBjbGFzcz0iY2xzLTIiIHBvaW50cz0iMy41NCA1LjMzIDIuNDggNi44MiAxLjQxIDUuMzMgMy41NCA1LjMzIi8+PC9zdmc+) no-repeat 100% 50%;
        -moz-appearance: none;
        -webkit-appearance: none;
        -webkit-border-radius: 0px;
        appearance: none;
      }

      #prevBtn {
        margin-top: 40px;
        width:fit-content;
        background-color: #bbbbbb;
      }

      #nextBtn {
        margin-top: 40px;
        width: fit-content;
      }

      .step {
        height: 10px;
        width: 10px;
        margin: 0 1px;
        background-color: #bbbbbb;
        border: none;  
        border-radius: 50%;
        display: inline-block;
        opacity: 0.5;
      }

      .step.active {
        opacity: 1;
      }

      .step.finish {
        background-color: #8a63f2;
      }

      .error_message {
        font-size: x-small;
        color: red;
        display: block;
        margin-top: 2px;
      }

      .required-symbol {
        font-size: small;
        color: red;
      }

    </style>
  </head>
  <body>
    <div class="login-container">
      <div class="logo">Sowfee Health</div>

      <form id="loginForm" method="POST" action="/register/">
        {% csrf_token %}
        <input type="hidden" id="csrf_token" value="{{ csrf_token }}" />
        
        <!-- Page 1 of multi-step form-->
        <div id="one">

          <!-- Institution selection dropdown -->
          <div class="form-group select-container">
            <label for="institution">Institution <span class="required-symbol">*</span></label>
              <select
                class="form-select"
                name="institution_name"
                id="institution"
                required
              >
                <option value="" selected disabled> Select your institution </option>
                {% for institution_name in institution_names %}
                  <option value="{{ institution_name }}"> {{ institution_name }}</option>
                {% endfor %}
              </select>
              <span id="institution-error" class="error_message"></span>
          </div>
          
          <!-- Full name input -->
          <div class="form-group">
            <label for="name">Full Name <span class="required-symbol">*</span></label>
            <input
              type="text"
              id="name"
              name="name"
              placeholder="Enter your full name"
              required="required"
              />
            <span id="name-error" class="error_message"></span>
          </div>
        </div>
        
        <!-- Page 2 of multi-step form -->
        <div id="two">
          <!-- Insitutional email input -->
          <div class="form-group">
            <label for="email">Email <span class="required-symbol">*</span></label>
            <input
              type="email"
              id="email"
              name="email"
              placeholder="Enter your institutional email"
              required
            />
            <span id="email-error" class="error_message"></span>
          </div>

          <!-- Password input -->
          <div class="form-group">
            <label for="password">Password <span class="required-symbol">*</span></label>
            <input
              type="password"
              id="password"
              name="password"
              placeholder="Enter your password"
              required
            />
            <span id="password-error" class="error_message"></span>
          </div>

          <!-- Confirm password input -->
          <div class="form-group">
            <label for="confirm_password">Confirm Password <span class="required-symbol">*</span></label>
            <input
              type="password"
              id="confirm_password"
              name="confirm_password"
              placeholder="Confirm your password"
              required
            />
            <span id="confirm-password-error" class="error_message"></span>
          </div>
        </div>

        <div style="text-align:center;margin-top:40px;">
          <span class="step"></span>
          <span class="step"></span>
        </div>

        <div style="overflow:auto">
          <div style="float:right; display: flex;">
            <button type="button" class="login-btn" id="prevBtn"> Previous </button>
            <button type="button" class="login-btn" id="nextBtn"> Next </button>
            <button type="submit" class="login-btn" id="submit_btn" style="height: fit-content; margin-top: 40px;"> Submit </button>
          </div>
        </div>

      </form>

      <!-- Modal for messages -->
      {% if messages %}
      <div id="messageModal" class="modal">
        <div class="modal-content">
          <span class="close-button">&times;</span>
          {% for message in messages %}
          <p
            style="{% if message.tags == 'success' %}color: #155724;{% else %}color: #721c24;{% endif %}"
          >
            {{ message }}
          </p>
          {% endfor %}
        </div>
      </div>

      <script>
        window.onload = function () {
          console.log("Hello!");
          var modal = document.getElementById("messageModal");
          modal.style.display = "block";

          var closeButton = document.getElementsByClassName("close-button")[0];
          closeButton.onclick = function () {
            modal.style.display = "none";
          };

          window.onclick = function (event) {
            if (event.target == modal) {
              modal.style.display = "none";
            }
          };
        };
      </script>
      {% endif %}

      <script>
        const form_element = document.getElementById("loginForm");
        const nav_left = document.getElementById("prevBtn");
        const nav_right = document.getElementById("nextBtn");
        const submit_btn = document.getElementById("submit_btn");
        const step_dots = document.getElementsByClassName("step");
        const institution_input = document.getElementById("institution");
        const name_input = document.getElementById("name");
        const email_input = document.getElementById("email");
        const password_input = document.getElementById("password");
        const confirm_password_input = document.getElementById("confirm_password");
        const form_steps = ["one", "two"];
        let current_step = 0;
        
        /** 
         * show_error displays an error message below inputs
         * @param {} input input element constaining the error
         * @param {string} value error message to display
        */
        function show_error(input, value) {
          const form_control = input.parentElement;
          const error_span = form_control.querySelector(".error_message");
          error_span.textContent = value;
        };

        /** 
         * clear_error removes the error message displayed for an input
         * @param {} input input element with an error message displayed
        */
        function clear_error(input) {
          const form_control = input.parentElement;
          const error_span = form_control.querySelector(".error_message");
          error_span.textContent = "";
        }

        /** 
         * validate_step checks if all the inputs were entered correctly in the current step
         * @param {number} step current step
        */
        function validate_step(step) {
          let is_valid = true;

          if (current_step === 0) {
            // Check is an institution was selected
            if (institution_input.value.trim() === "") {
              show_error(institution_input, "Please select an institution");
              is_valid = false;
            }

            // Check if a name was entered
            if (name_input.value.trim() === "") {
              show_error(name_input, "Please enter a name");
              is_valid = false;
            }

          } else {
            // Check is a valid email was entered
            if (email_input.value.trim() === "") {
              show_error(email_input, "Please enter an email");
              is_valid = false;
            } else if (/^.+@.+\.edu/.test(email_input.value) === false) {
              show_error(email_input, "Please enter a valid institution email");
              is_valid = false;
            }
            
            // Check if a password was entered
            if (password_input.value.trim() === "") {
              show_error(password_input, "Please enter a password");
              is_valid = false;
            } 
            
            // Check if confirm password was entered
            if (confirm_password_input.value.trim() === "") {
              show_error(confirm_password_input, "Please enter a password");
              is_valid = false;
            }
          }

          return is_valid;

        };

        /** 
         * setup_real_time_validation adds event listeners to clear error messages
        */
        function setup_real_time_validation() {
          name_input.addEventListener("input", () => clear_error(name_input));
          institution_input.addEventListener("change", () => clear_error(institution_input));
          email_input.addEventListener("input", () => clear_error(email_input));
          password_input.addEventListener("input", () => clear_error(password_input));
          confirm_password_input.addEventListener("input", () => clear_error(confirm_password_input));
        };

        /** 
         * update_step_visibility allows users to move to the next step
        */
        function update_step_visibility() {
          
          form_steps.forEach((step, idx) => {
            document.getElementById(step).style.display = "none";
            step_dots[idx].style.backgroundColor = "#bbbbbb";
          });

          document.getElementById(form_steps[current_step]).style.display = "block";
          step_dots[current_step].style.backgroundColor = "#8a63f2";
          nav_left.style.display = current_step === 0 ? "none" : "block";
          nav_right.style.display = current_step === form_steps.length - 1 ? "none" : "block";
          submit_btn.style.display = current_step === form_steps.length - 1 ? "block" : "none";
        };

        document.addEventListener("DOMContentLoaded", () => {
          nav_left.style.display = "none";
          update_step_visibility();
          setup_real_time_validation();
          form_element.addEventListener("submit", (e) => {
            if (!validate_step(current_step)) {
              e.preventDefault();
            }
          });

          nav_left.addEventListener("click", () => {
            if ((current_step > 0) && validate_step(current_step)) {
              current_step -= 1;
              update_step_visibility();
            }
          });

          nav_right.addEventListener("click", () => {
            if ((current_step < form_steps.length - 1) && validate_step(current_step)) {
              current_step += 1;
              update_step_visibility();
            }
          });
        });
      </script>
    </div>
  </body>
</html>
